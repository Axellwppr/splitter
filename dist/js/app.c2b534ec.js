(function(t){function e(e){for(var a,i,o=e[0],l=e[1],c=e[2],d=0,p=[];d<o.length;d++)i=o[d],Object.prototype.hasOwnProperty.call(n,i)&&n[i]&&p.push(n[i][0]),n[i]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(t[a]=l[a]);u&&u(e);while(p.length)p.shift()();return s.push.apply(s,c||[]),r()}function r(){for(var t,e=0;e<s.length;e++){for(var r=s[e],a=!0,o=1;o<r.length;o++){var l=r[o];0!==n[l]&&(a=!1)}a&&(s.splice(e--,1),t=i(i.s=r[0]))}return t}var a={},n={app:0},s=[];function i(e){if(a[e])return a[e].exports;var r=a[e]={i:e,l:!1,exports:{}};return t[e].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=a,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)i.d(r,a,function(e){return t[e]}.bind(null,a));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],l=o.push.bind(o);o.push=e,o=o.slice();for(var c=0;c<o.length;c++)e(o[c]);var u=l;s.push([0,"chunk-vendors"]),r()})({0:function(t,e,r){t.exports=r("56d7")},"56d7":function(t,e,r){"use strict";r.r(e);var a=r("8bbf"),n=r.n(a),s=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("v-app",[r("v-app-bar",{attrs:{"elevate-on-scroll":"",app:"",color:"light-blue lighten-1",dark:""}},[r("v-app-bar-nav-icon"),r("v-toolbar-title",[t._v("听力切分器")]),r("v-spacer")],1),r("v-main",[r("v-container",[10==t.step&&t.data.length?r("span",[t._l(t.data,(function(e,a){return[r("v-row",{key:a,attrs:{align:"start",justify:"center"}},["Pause"==e.tag?r("v-col",{staticStyle:{"max-width":"275px"},attrs:{cols:"8",sm:"5"}},[r("div",{staticClass:"\n                                    pa-4\n                                    blue-grey\n                                    darken-2\n                                    rounded-pill\n                                    text-center\n                                    white--text\n                                "},[t._v(" Pause duration:"+t._s(e.durationH)+" s ")])]):r("v-col",{attrs:{cols:"11",sm:"8"}},[r("v-card",{attrs:{color:"Instruction"!==e.tag?"orange darken-1":"teal",dark:""}},[r("v-card-title",{staticClass:"text-h5"},[t._v(" "+t._s(e.tag)+" ")]),r("v-card-subtitle",{staticClass:"d-flex pb-0"},[r("div",{staticClass:"mr-3"},[t._v(" start: "+t._s(t.times(e.startH))+" ")]),r("div",{staticClass:"mr-3"},[t._v(" end: "+t._s(t.times(e.endH))+" ")]),r("div",{staticClass:"mr-3"},[t._v(" duration: "+t._s(e.durationH)+" s ")]),r("v-spacer"),r("div",[t._v(" state: "),t.ready[a]?r("span",{staticClass:"white--text"},[t._v("ready")]):r("span",[t._v("null")])])],1),r("v-card-actions",[r("v-spacer"),r("v-btn",{attrs:{text:""},on:{click:function(r){return t.process(e,"listen")}}},[t._v(" Listen ")]),r("v-btn",{attrs:{text:""},on:{click:function(r){return t.process(e,"download")}}},[t._v(" Download ")])],1)],1)],1)],1)]}))],2):t._e(),r("v-dialog",{attrs:{value:10==t.step&&!t.data.length,persistent:"",width:"390px","open-delay":"500",scrollable:""}},[r("v-card",[r("v-card-title",[t._v(" An Error Occurred ")]),r("v-card-text",[t._v(" 该音频中没有有效片段")])],1)],1)],1),r("v-dialog",{attrs:{value:0==t.step,persistent:"",width:"390px",scrollable:"","open-delay":"500","close-delay":"1000"}},[r("v-card",[r("v-card-title",[t._v(" 静态组件加载中 ")]),r("v-card-text",[r("v-progress-linear",{attrs:{indeterminate:"",color:"cyan"}}),t._v("正在加载FFMPEG,请稍候")],1)],1)],1),r("v-dialog",{attrs:{value:1==t.step,persistent:"",width:"390px",scrollable:"","open-delay":"500","close-delay":"1000"}},[r("v-card",[r("v-card-title",[t._v(" 选择听力文件 ")]),r("v-card-text",[r("v-form",{ref:"form"},[r("v-file-input",{staticClass:"pt-2",attrs:{"show-size":"",outlined:"",dense:"",accept:"audio/mp3",label:"请点此选择文件",rules:[function(t){return!t||t.size<4e7||"Audio size should be less than 40 MB!"},function(t){return!t||"audio/mpeg"==t.type||"Audio file should be of MP3 format!"}]},model:{value:t.file,callback:function(e){t.file=e},expression:"file"}})],1)],1),r("v-card-actions",[r("v-spacer"),r("v-btn",{attrs:{text:""},on:{click:function(e){return t.inputDone()}}},[t._v(" OK ")])],1)],1)],1),r("v-dialog",{attrs:{value:2==t.step,persistent:"",width:"390px",scrollable:"","open-delay":"500","close-delay":"1000"}},[r("v-card",[r("v-card-title",[t._v(" 正在处理 ")]),r("v-card-text",[r("v-progress-linear",{attrs:{value:t.progress.num,color:"cyan"}}),t._v("正在对该文件进行分割,请稍候")],1)],1)],1),r("v-dialog",{attrs:{value:t.player.show,persistent:"",width:"410px",scrollable:"","open-delay":"500","close-delay":"1000"}},[r("v-card",[r("v-card-title",[t._v(" 音频"+t._s("listen"==t.player.type?"预览":"下载")+" ")]),t.player.src?r("v-card-text",{staticClass:"text-center"},["listen"==t.player.type?r("audio",{attrs:{src:t.player.src,controls:"controls"}},[t._v(" Your browser do NOT support audio feature! ")]):r("a",{attrs:{href:t.player.src,download:t.player.name}},[t._v("Click to Download")])]):r("v-card-text",[t._v(" 该片段尚未切割完成,请等待切割完成后再次点击按钮")]),t.player.loading?t._e():r("v-card-actions",[r("v-spacer"),r("v-btn",{attrs:{text:""},on:{click:function(e){t.player.show=!1}}},[t._v(" CLOSE ")])],1)],1)],1),r("v-dialog",{attrs:{value:t.step<=-10,persistent:"",width:"390px","open-delay":"500",scrollable:""}},[r("v-card",[r("v-card-title",[t._v(" An Error Occurred ")]),r("v-card-text",[-10==t.step?r("span",[t._v("FFMPEG加载失败,请刷新网页重试"),r("br"),t._v(t._s(t.ffmpegE))]):t._e(),-11==t.step?r("span",[t._v("切分失败,请刷新网页重试")]):t._e()])],1)],1)],1)],1)},i=[],o=r("bd2d");const{createFFmpeg:l,fetchFile:c}=FFmpeg,u=l({}),d=Object(o["create"])(o["all"],{number:"BigNumber"});var p=(t,e)=>{for(var r=t=>{for(var e=0;e<=3;++e)if(10!=t[e])return!1;if(5!=t[4])return!1;var r=0;for(e=5;e<t.length-1;e+=2){if(t[e]!=t[e+1]||t[e]%5!=0||t[e+1]%5!=0)return!1;r+=t[e]/5}return 15==r},a=-1,n=1;n+15<=t.length;++n)r(t.slice(n,n+15))&&(a=n);if(-1==a)return!1;var s=1;for(n=a-1;n<=a+3;++n)e[n].tag="Text"+s++;for(n=a+5;n<=a+13;n+=2)e[n].tag="Text"+s++;return!0},h={name:"App",data:()=>({data:[],ready:[],step:0,file:null,player:{show:!1,loading:!1,src:"",type:"",name:""},ffmpegE:"",uid:0,halt:0,progress:{running:!1,num:0}}),async mounted(){try{await u.load(),await u.run("-v"),u.setProgress(t=>{this.progress.num=Math.round(1e3*t.ratio)/10})}catch(t){return this.ffmpegE=t.toString(),this.step=-10,!1}return this.step=1,!0},methods:{times(t){let e="",r=t=>t<10?"0"+t:""+t,a=0,n=0,s=0;if(t<60)e="00:"+r(t);else if(t>=60&&t<3600)a=parseInt(t/60),n=parseInt(t%60),e=`${r(a)}:${r(n)}`;else if(t>=3600){let i=parseInt(t%3600);s=parseInt(t/3600),a=parseInt(i/60),n=parseInt(i%60),e=`${r(s)}:${r(a)}:${r(n)}`}return e},async split(t){if(!this.progress.running){try{this.progress.running=!0,await u.run("-i","input.mp3","-ss",d.chain(t.start).toString(),"-t",d.chain(t.duration).toString(),`output_${this.uid}.mp3`);var e=u.FS("readFile",`output_${this.uid}.mp3`),r=URL.createObjectURL(new Blob([e.buffer],{type:"audio/mp3"}));u.FS("unlink",`output_${this.uid}.mp3`),this.uid++}catch(a){console.log(a,t),this.step=-11}return this.progress.running=!1,r}},async inputDone(){if(!this.$refs.form.validate())return!1;if(!this.file)return!1;this.step=2;try{var t=this.file;u.FS("writeFile","input.mp3",await c(t)),console.log("File Loaded");var e=[],r=[],a=[];u.setLogger(({type:t,message:n})=>{var s=n.match(/^\[silencedetect @ \S{9}\] silence_end: (\S*) \| silence_duration: (\S*)/);if(s){var i=d.evaluate(s[1]),o=d.evaluate(s[2]);e.push({start:d.subtract(i,o),end:i,duration:o,startH:d.chain(d.subtract(i,o)).round().toString(),endH:d.chain(i).round().toString(),durationH:d.chain(o).round(2).toString(),tag:"Pause"});var l=d.chain(o).ceil().divide(5).floor().multiply(5).done();console.log(d.chain(o).subtract(l).smallerEq(2).done()&&d.chain(o).subtract(l).largerEq(-.5).done()),d.chain(o).subtract(l).smallerEq(2).done()&&d.chain(o).subtract(l).largerEq(-.5).done()?r.push(d.numeric(d.round(l,2),"number")):r.push(d.numeric(d.round(o,2),"number")),e.length>1&&a.push({start:e[e.length-2].end,end:e[e.length-1].start,duration:d.subtract(e[e.length-1].start,e[e.length-2].end),startH:d.chain(e[e.length-2].end).round().toString(),endH:d.chain(e[e.length-1].start).round().toString(),durationH:d.chain(d.subtract(e[e.length-1].start,e[e.length-2].end)).round(2).toString(),tag:"Instruction"})}}),await u.run("-i","input.mp3","-af","silencedetect=n=-50dB:d=4","-f","null","-"),console.log(r),console.log(e),u.setLogging(!1),console.log(a);for(var n=1;n<r.length;++n)if(r[n]>=30){r.splice(n);break}if(p(r,a))console.log("match rule 1"),console.log(a);else{console.log("no rule match");for(n=0;n<a.length;++n)a[n].tag="Unknown"}var s=[];e[0]&&s.push(e[0]);for(n=0;n<a.length;++n)s.push(a[n]),e[n+1]&&s.push(e[n+1]);console.log(s),this.data=s,this.ready=new Array(s.length),this.background(),this.step=10}catch(i){this.step=-11}},async process(t,e){try{this.player.show=!0,this.player.type=e,this.player.name=`${this.file.name} sub_${this.times(t.startH)}_${this.times(t.endH)}.mp3`,this.player.src=t.src}catch(r){this.step=-11}},background(){this.interval=setInterval(async()=>{if(this.halt>0)return!1;console.log("Finding"),this.halt=1;for(var t=-1,e=0;e<this.data.length;++e){if(t>=0)break;0!=this.data[e].tag.indexOf("Text")||this.data[e].src||(console.log(this.data[e].tag),t=e)}for(e=0;e<this.data.length;++e){if(t>=0)break;"Pause"==this.data[e].tag||this.data[e].src||(console.log(this.data[e].tag),t=e)}if(-1!=t){console.log(t);var r=await this.split(this.data[t]);console.log("OK"),this.data[t].src=r,this.$set(this.ready,t,!0),2!=this.halt&&(this.halt=0)}else clearInterval(this.interval)},1e3)}}},v=h,f=r("2877"),g=r("6544"),b=r.n(g),y=r("7496"),m=r("40dc"),_=r("5bc1"),w=r("8336"),x=r("b0af"),S=r("99d9"),k=r("62ad"),O=r("a523"),V=r("169a"),C=r("23a7"),F=r("4bd4"),P=r("f6c4"),$=r("8e36"),j=r("0fd9"),E=r("2fa4"),H=r("2a7f"),I=Object(f["a"])(v,s,i,!1,null,null,null),T=I.exports;b()(I,{VApp:y["a"],VAppBar:m["a"],VAppBarNavIcon:_["a"],VBtn:w["a"],VCard:x["a"],VCardActions:S["a"],VCardSubtitle:S["b"],VCardText:S["c"],VCardTitle:S["d"],VCol:k["a"],VContainer:O["a"],VDialog:V["a"],VFileInput:C["a"],VForm:F["a"],VMain:P["a"],VProgressLinear:$["a"],VRow:j["a"],VSpacer:E["a"],VToolbarTitle:H["a"]}),n.a.config.productionTip=!1,new n.a({vuetify:new Vuetify,render:function(t){return t(T)}}).$mount("#app")},"8bbf":function(t,e){t.exports=Vue},bd2d:function(t,e){t.exports=math}});